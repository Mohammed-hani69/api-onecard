<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª - OneCard API</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ -->
    <nav class="navbar">
        <div class="container">
            <div class="navbar-brand">
                <h1>ğŸ Ù…ØªØ¬Ø± OneCard</h1>
            </div>
            <ul class="navbar-menu">
                <li><a href="/" class="nav-link">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                <li><a href="/products" class="nav-link">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a></li>
                <li><a href="/cart" class="nav-link">Ø§Ù„Ø³Ù„Ø© <span class="cart-count" id="cartCount">0</span></a></li>
                <li><a href="/transactions" class="nav-link active">Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</a></li>
            </ul>
        </div>
    </nav>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <main class="container">
        <h2>ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h2>
        
        <!-- ØªØµÙÙŠØ© Ø§Ù„Ø­Ø§Ù„Ø© -->
        <section class="filter-section">
            <form method="get" class="filter-form">
                <select name="status" class="form-control" onchange="this.form.submit()">
                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</option>
                    <option value="success" {% if selected_status == 'success' %}selected{% endif %}>Ù†Ø§Ø¬Ø­</option>
                    <option value="failed" {% if selected_status == 'failed' %}selected{% endif %}>ÙØ´Ù„</option>
                    <option value="pending" {% if selected_status == 'pending' %}selected{% endif %}>Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                </select>
            </form>
        </section>

        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª -->
        <section class="transactions-section">
            {% if transactions.items %}
                <table class="transactions-table">
                    <thead>
                        <tr>
                            <th>Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</th>
                            <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                            <th>Ø§Ù„ÙƒÙˆØ¯</th>
                            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙˆØ§Ø­Ø¯</th>
                            <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for transaction in transactions.items %}
                            <tr class="transaction-row status-{{ transaction.status }}">
                                <td class="transaction-id">
                                    <code>{{ transaction.transaction_id[:8] }}...</code>
                                </td>
                                <td class="product-name">{{ transaction.product_name }}</td>
                                <td class="product-code">{{ transaction.product_id }}</td>
                                <td class="quantity">{{ transaction.quantity }}</td>
                                <td class="price">{{ "%.2f"|format(transaction.unit_price) }} Ø±.Ø³</td>
                                <td class="total">
                                    <strong>{{ "%.2f"|format(transaction.total_price) }} Ø±.Ø³</strong>
                                </td>
                                <td class="status">
                                    {% if transaction.status == 'success' %}
                                        <span class="badge badge-success">âœ“ Ù†Ø§Ø¬Ø­</span>
                                    {% elif transaction.status == 'failed' %}
                                        <span class="badge badge-danger">âœ— ÙØ´Ù„</span>
                                    {% else %}
                                        <span class="badge badge-warning">â³ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</span>
                                    {% endif %}
                                </td>
                                <td class="date">{{ transaction.created_at }}</td>
                            </tr>
                            
                            <!-- ØµÙ Ø¥Ø¶Ø§ÙÙŠ Ù„Ù„Ø£Ø®Ø·Ø§Ø¡ Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª -->
                            {% if transaction.error_message %}
                                <tr class="error-detail">
                                    <td colspan="8">
                                        <strong>Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£:</strong> 
                                        ({{ transaction.error_code }}) {{ transaction.error_message }}
                                    </td>
                                </tr>
                            {% endif %}
                        {% endfor %}
                    </tbody>
                </table>

                <!-- Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª -->
                {% if transactions.pages > 1 %}
                    <div class="pagination">
                        {% if transactions.has_prev %}
                            <a href="?page=1&status={{ selected_status }}" class="btn btn-sm">Ø§Ù„Ø£ÙˆÙ„</a>
                            <a href="?page={{ transactions.prev_num }}&status={{ selected_status }}" class="btn btn-sm">Ø§Ù„Ø³Ø§Ø¨Ù‚</a>
                        {% endif %}

                        {% for page_num in transactions.iter_pages() %}
                            {% if page_num %}
                                {% if page_num == transactions.page %}
                                    <span class="current-page">{{ page_num }}</span>
                                {% else %}
                                    <a href="?page={{ page_num }}&status={{ selected_status }}" class="btn btn-sm">{{ page_num }}</a>
                                {% endif %}
                            {% else %}
                                <span class="pagination-dots">...</span>
                            {% endif %}
                        {% endfor %}

                        {% if transactions.has_next %}
                            <a href="?page={{ transactions.next_num }}&status={{ selected_status }}" class="btn btn-sm">Ø§Ù„ØªØ§Ù„ÙŠ</a>
                            <a href="?page={{ transactions.pages }}&status={{ selected_status }}" class="btn btn-sm">Ø§Ù„Ø£Ø®ÙŠØ±</a>
                        {% endif %}
                    </div>
                {% endif %}
            {% else %}
                <div class="no-transactions">
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª</p>
                </div>
            {% endif %}
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2024 Ù†Ø¸Ø§Ù… OneCard API. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
    </footer>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ù„Ø©
        updateCartCount();
    </script>
</body>
</html>
