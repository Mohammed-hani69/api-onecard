<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª - OneCard API</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ -->
    <nav class="navbar">
        <div class="container">
            <div class="navbar-brand">
                <h1>ğŸ Ù…ØªØ¬Ø± OneCard</h1>
            </div>
            <ul class="navbar-menu">
                <li><a href="/" class="nav-link">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                <li><a href="/products" class="nav-link active">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a></li>
                <li><a href="/cart" class="nav-link">Ø§Ù„Ø³Ù„Ø© <span class="cart-count" id="cartCount">0</span></a></li>
                <li><a href="/transactions" class="nav-link">Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</a></li>
            </ul>
        </div>
    </nav>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <main class="container">
        <!-- Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ© -->
        <section class="search-section">
            <h2>Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ©</h2>
            <form method="get" class="search-form">
                <div class="form-group">
                    <input type="text" name="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬..." 
                           value="{{ search }}" class="form-control">
                </div>
                <div class="form-group">
                    <select name="category" class="form-control">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>
                        {% for cat in categories %}
                            <option value="{{ cat }}" 
                                {% if cat == selected_category %}selected{% endif %}>
                                {{ cat }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Ø¨Ø­Ø«</button>
            </form>
        </section>

        <!-- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
        <section class="products-section">
            <h2>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© ({{ products.total }})</h2>
            
            {% if products.items %}
                <div class="products-grid">
                    {% for product in products.items %}
                        <div class="product-card">
                            <!-- ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ -->
                            {% if product.image %}
                                <div class="product-image">
                                    <img src="{{ product.image }}" alt="{{ product.name_en }}">
                                </div>
                            {% else %}
                                <div class="product-image placeholder">
                                    <span>Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø©</span>
                                </div>
                            {% endif %}

                            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ -->
                            <div class="product-info">
                                <h3>{{ product.name_ar or product.name_en }}</h3>
                                <p class="product-id">Ø§Ù„ÙƒÙˆØ¯: {{ product.product_id }}</p>
                                <p class="product-category">{{ product.category_name_ar or product.category_name_en }}</p>
                                <p class="product-merchant">{{ product.merchant_name_ar or product.merchant_name_en }}</p>

                                <!-- Ø§Ù„Ø£Ø³Ø¹Ø§Ø± -->
                                <div class="product-prices">
                                    {% if product.face_value %}
                                        <p class="face-value">Ø§Ù„Ù‚ÙŠÙ…Ø©: {{ "%.2f"|format(product.face_value) }} {{ product.currency or 'SAR' }}</p>
                                    {% endif %}
                                    {% if product.recommended_retail_price_after_vat %}
                                        <p class="price-main">Ø§Ù„Ø³Ø¹Ø±: <strong>{{ "%.2f"|format(product.recommended_retail_price_after_vat) }} {{ product.currency or 'SAR' }}</strong></p>
                                    {% elif product.cost_price_after_vat %}
                                        <p class="price-main">Ø§Ù„Ø³Ø¹Ø±: <strong>{{ "%.2f"|format(product.cost_price_after_vat) }} {{ product.currency or 'SAR' }}</strong></p>
                                    {% endif %}
                                </div>

                                <!-- Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© -->
                                {% if product.available %}
                                    <button class="btn btn-success" onclick="addToCart('{{ product.product_id }}', '{{ product.name_ar or product.name_en }}')">
                                        â• Ø£Ø¶ÙŠÙ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©
                                    </button>
                                {% else %}
                                    <button class="btn btn-disabled" disabled>
                                        âŒ ØºÙŠØ± Ù…ØªØ§Ø­
                                    </button>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>

                <!-- Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª -->
                {% if products.pages > 1 %}
                    <div class="pagination">
                        {% if products.has_prev %}
                            <a href="?page=1&search={{ search }}&category={{ selected_category }}" class="btn btn-sm">Ø§Ù„Ø£ÙˆÙ„</a>
                            <a href="?page={{ products.prev_num }}&search={{ search }}&category={{ selected_category }}" class="btn btn-sm">Ø§Ù„Ø³Ø§Ø¨Ù‚</a>
                        {% endif %}

                        {% for page_num in products.iter_pages() %}
                            {% if page_num %}
                                {% if page_num == products.page %}
                                    <span class="current-page">{{ page_num }}</span>
                                {% else %}
                                    <a href="?page={{ page_num }}&search={{ search }}&category={{ selected_category }}" class="btn btn-sm">{{ page_num }}</a>
                                {% endif %}
                            {% else %}
                                <span class="pagination-dots">...</span>
                            {% endif %}
                        {% endfor %}

                        {% if products.has_next %}
                            <a href="?page={{ products.next_num }}&search={{ search }}&category={{ selected_category }}" class="btn btn-sm">Ø§Ù„ØªØ§Ù„ÙŠ</a>
                            <a href="?page={{ products.pages }}&search={{ search }}&category={{ selected_category }}" class="btn btn-sm">Ø§Ù„Ø£Ø®ÙŠØ±</a>
                        {% endif %}
                    </div>
                {% endif %}
            {% else %}
                <div class="no-products">
                    <p>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù†ØªØ¬Ø§Øª</p>
                </div>
            {% endif %}
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2024 Ù†Ø¸Ø§Ù… OneCard API. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
    </footer>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        updateCartCount();
    </script>
</body>
</html>
